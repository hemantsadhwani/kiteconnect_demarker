# Trade Configuration
TRADE_SETTINGS:
  # Common Settings
  QUANTITY: 65 # Nifty 50 current lot size
  CAPITAL: 15000 # Max capital to use per trade
  PRODUCT: "NRML" # NRML is required for GTT orders
  
  # Entry Risk Validation (Pre-Entry Risk Assessment)
  VALIDATE_ENTRY_RISK: true # Enable entry risk validation before trade
  # Price-based REVERSAL_MAX_SWING_LOW_DISTANCE_PERCENT Configuration
  # Three-tier system (uses same thresholds as STOP_LOSS_PRICE_THRESHOLD):
  # - If option price > highest threshold (120), use ABOVE_THRESHOLD percentage (13%)
  # - If option price is between thresholds (70-120), use BETWEEN_THRESHOLD percentage (12%)
  # - If option price < lowest threshold (70), use BELOW_THRESHOLD percentage (15%)
  REVERSAL_MAX_SWING_LOW_DISTANCE_PERCENT:
    ABOVE_THRESHOLD: 13  # Max swing low distance % when entry price > 120
    BETWEEN_THRESHOLD: 13  # Max swing low distance % when entry price is between 70 and 120
    BELOW_THRESHOLD: 15  # Max swing low distance % when entry price < 70
  CONTINUATION_MAX_SUPERTREND_DISTANCE_PERCENT: 6 # Max SuperTrend distance for CONTINUATION entries (useEntry3)
  
  # Trade Settings
  # Price-based Stop Loss Configuration
  # Three-tier system:
  # - If option price > highest threshold (120), use ABOVE_THRESHOLD percentage (6.0%)
  # - If option price is between thresholds (70-120), use BETWEEN_THRESHOLD percentage (7.0%)
  # - If option price < lowest threshold (70), use BELOW_THRESHOLD percentage (8.0%)
  STOP_LOSS_PRICE_THRESHOLD: [140, 40] # Price thresholds for stop loss selection [high, low]
  STOP_LOSS_PERCENT:
    ABOVE_THRESHOLD: 6.5  # Stop loss % when entry price > 120
    BETWEEN_THRESHOLD: 7.5  # Stop loss % when entry price is between 70 and 120
    BELOW_THRESHOLD: 7.5  # Stop loss % when entry price < 70
  # Legacy single value (for backward compatibility, will be overridden by above if both exist)
  # STOP_LOSS_PERCENT: 6.0 # Fixed percentage stop loss (Stage 1) - DEPRECATED: Use STOP_LOSS_PERCENT.ABOVE_THRESHOLD/BELOW_THRESHOLD
  TAKE_PROFIT_PERCENT: 7.0 # Fixed percentage take profit (Stage 1, redundant if DYNAMIC_TRAILING_MA is active)
  # Dynamic Trailing MA Configuration (Stage 3)
  DYNAMIC_TRAILING_MA: true # Enable MA-based dynamic trailing for Entry2 trades
  DYNAMIC_TRAILING_MA_THRESH: 7 # Percentage above entry to activate MA trailing (e.g., 7%)
  # EXIT_WEAK_SIGNAL (R1-R2 zone only): when high >= 7%, if DeMarker < R_BAND exit at 7% else start trailing
  EXIT_WEAK_SIGNAL: true
  EXIT_WEAK_SIGNAL_PROFIT_PCT: 7.0
  EXIT_WEAK_SIGNAL_DEMARKER_R_BAND: 0.60
  # Entry Conditions - Separate for CE and PE
  # Entry1: Fast reversal (WPR9)
  # Entry2: Multi-signal confirmation (configurable window via ENTRY2_CONFIRMATION_WINDOW)
  # Entry3: Continuation (StochRSI + SuperTrend)
  CE_ENTRY_CONDITIONS:
    useEntry1: false # Disabled - Entry 1 (Fast Reversal) for CE
    useEntry2: true # Enabled - Entry 2 (Multi-signal confirmation, configurable window) for CE
    useEntry3: false # Disabled - Entry 3 (StochRSI K/D crossover with SuperTrend) for CE
  
  PE_ENTRY_CONDITIONS:
    useEntry1: false # Disabled - Entry 1 (Fast Reversal) for PE
    useEntry2: true # Enabled - Entry 2 (Multi-signal confirmation, configurable window) for PE
    useEntry3: false # Disabled - Entry 3 (StochRSI K/D crossover with SuperTrend) for PE
    
  WAIT_BARS_RSI: 3 # Bars to wait for StochRSI confirmation
  ENTRY2_CONFIRMATION_WINDOW: 4 # Number of candles (T, T+1, T+2) for WPR28 and StochRSI confirmations
  # Entry2 logic mode: true = Flexible (StochRSI can confirm even if SuperTrend turns bullish)
  #                    false = Strict (All confirmations must occur when SuperTrend is bearish)
  FLEXIBLE_STOCHRSI_CONFIRMATION: true
  # DEBUG_ENTRY2: When enabled, Entry2 will skip SuperTrend and sentiment checks for testing
  # This allows more frequent trades to test trigger + confirmation logic in real-time
  # When disabled, uses production Entry2 with full SuperTrend and sentiment requirements
  DEBUG_ENTRY2: false
  
  # SKIP_FIRST Feature Configuration
  # Skips the first Entry2 signal after SuperTrend switches from bullish to bearish
  # ONLY when both Nifty 9:30 sentiment and CPR Pivot sentiment are BEARISH
  # Note: Kite API is ALWAYS required for CPR Pivot calculation (no alternative source exists)
  SKIP_FIRST: false

# High-Water Mark Trailing Stop Risk Management
# Implements trailing max drawdown to cap daily losses from highest PnL/capital
MARK2MARKET:
  ENABLE: true  # Enable/disable trailing stop logic
  CAPITAL: 15000  # Starting daily capital
  LOSS_MARK: 35  # Percentage drop from High-Water Mark to trigger stop
  PER_DAY: true  # Each day starts fresh with CAPITAL, tracks day's high, stops if drops LOSS_MARK% from day's high 

# Bot Operational Settings
TRADING_HOURS:
  START_HOUR: 9
  START_MINUTE: 15
  END_HOUR: 15
  END_MINUTE: 29

MARKET_CLOSE:
  HOUR: 15
  MINUTE: 14

# CPR-derived trading range: entry only when Nifty at entry is between CPR_LOWER and CPR_UPPER.
# CPR and Fib bands are computed on bot init from previous trading day Nifty OHLC (Kite API).
# CPR_UPPER and CPR_LOWER are printed at startup for verification.
CPR_TRADING_RANGE:
  ENABLED: true
  CPR_UPPER: "band_R2_upper"   # band column name
  CPR_LOWER: "band_S2_lower"   # band column name

CPR_WIDTH_FILTER:
  ENABLED: false
  THRESHOLD: 62  # Disable autonomous trading for the day if CPR width exceeds this value

# Market Sentiment Filter
# When ENABLED: Filters trades based on market sentiment (BULLISH=CE only, BEARISH=PE only, NEUTRAL=both)
# When DISABLED: Allows both CE and PE trades simultaneously regardless of sentiment
MARKET_SENTIMENT_FILTER:
  ENABLED: false  # Set to false to allow both CE and PE trades simultaneously (matches backtesting behavior)

# Time Distribution Filter (No Trade Zones)
# When enabled, only trades within enabled time zones will be executed
# Zones set to false will block trades during those times
TIME_DISTRIBUTION_FILTER:
  ENABLED: true  # Set to true to enable time-based trade filtering
  TIME_ZONES:
    09:15-10:00: true
    10:00-11:00: true
    11:00-12:00: true
    12:00-13:00: false
    13:00-14:00: true
    14:00-15:30: true

# File Paths for State and Control
SENTIMENT_FILE_PATH: "output/market_sentiment.txt"
TRADE_STATE_FILE_PATH: "output/trade_state.json"
SUBSCRIBE_TOKENS_FILE_PATH: "output/subscribe_tokens.json"

# Indicator Configuration
INDICATORS:
  SUPERTREND:
    ATR_LENGTH: 10
    FACTOR: 2.5
  WPR_FAST_LENGTH: 9
  WPR_SLOW_LENGTH: 28
  SToch_RSI:
    K: 3
    D: 3
    RSI_LENGTH: 14
    STOCH_PERIOD: 14
  FAST_MA:
    MA: sma
    LENGTH: 11
  SLOW_MA:
    MA: sma
    LENGTH: 13
  SWING_LOW_PERIOD: 5
  DEMARKER:
    PERIOD: 14  # Same as backtesting (run_indicators.py / indicators_backtesting.py)

# Threshold Configuration for Entry Conditions
# NOTE: THRESHOLDS are now in backtesting/indicators_config.yaml (preferred location)
# This section is kept for backward compatibility only
# The code will load from indicators_config.yaml first, then fallback to this section
THRESHOLDS:
  WPR_FAST_OVERSOLD: -79    # Fast Williams %R oversold threshold (default: -80)
                            # WPR9 must cross above this value to trigger Entry2
  WPR_SLOW_OVERSOLD: -77    # Slow Williams %R oversold threshold (default: -80)
                            # WPR28 must cross above this value to trigger Entry2
  STOCH_RSI_OVERSOLD: 20 # Stochastic RSI oversold threshold (default: 20)
                         # StochK must be above this value AND above StochD to trigger Entry2

# Dynamic ATM Configuration
# Controls whether ATM strikes adjust intraday based on NIFTY price movements
DYNAMIC_ATM:
  ENABLED: true          # Set to false to use static ATM (strikes calculated once at market open)
  SLAB_CHANGE_ALERT: true # Log alerts when slab changes occur
  MIN_SLAB_CHANGE_INTERVAL: 180  # Minimum seconds between slab changes (prevents rapid switching)

# Strike Difference Configuration
# Controls the strike interval for ATM/OTM strike calculation
# Options: 50 (default, multiples of 50) or 100 (multiples of 100)
# For STRIKE_DIFFERENCE=50: CE = floor(price/50)*50, PE = ceil(price/50)*50
# For STRIKE_DIFFERENCE=100: CE = floor(price/100)*100, PE = ceil(price/100)*100
# Example: NIFTY=25510, STRIKE_DIFFERENCE=100 -> CE=25500, PE=25600
STRIKE_DIFFERENCE: 50  # Options: 50 or 100

# Strike Type Configuration
# Controls whether to use ATM (At-The-Money) or OTM (Out-of-The-Money) strike selection
# ATM: CE = FLOOR (at or below price), PE = CEIL (at or above price)
# OTM: PE = FLOOR (at or below price), CE = CEIL (at or above price)
# Example: NIFTY=25123.45, STRIKE_DIFFERENCE=50
#   ATM: CE=25100 (floor), PE=25150 (ceil)
#   OTM: PE=25100 (floor), CE=25150 (ceil)
STRIKE_TYPE: ATM  # Options: ATM or OTM

# Price Zone Filter Configuration
# Filters trades based on entry price - only takes trades if entry price is within specified range
# Based on backtesting win rate analysis
PRICE_ZONES:
  DYNAMIC_ATM:
    LOW_PRICE: 40   # Minimum entry price to take trade
    HIGH_PRICE: 200 # Maximum entry price to take trade
  STATIC_ATM:
    LOW_PRICE: 20    # Minimum entry price (0 = no lower limit)
    HIGH_PRICE: 250 # Maximum entry price (500 = no upper limit for now)

# Market Sentiment Configuration
# Simplified architecture: MODE determines how sentiment is determined
# AUTO: Use sentiment algorithm (v2, v3, etc.) - sentiment calculated automatically
# MANUAL: Use fixed sentiment (BULLISH, BEARISH, NEUTRAL, DISABLE) - sentiment set via control panel
# DISABLE: Stop all autonomous trades (manual BUY_CE/BUY_PE commands still allowed)
MARKET_SENTIMENT:
  MODE: MANUAL  # Options: AUTO | MANUAL | DISABLE
                # AUTO: Use sentiment algorithm (v2, v3, etc.)
                # MANUAL: Use fixed sentiment (BULLISH, BEARISH, NEUTRAL, DISABLE)
                # DISABLE: Stop all autonomous trades
  
  # Used when MODE=AUTO
  SENTIMENT_VERSION: "v2"  # Options: "v1" | "v2" | "v3" (future)
  CONFIG_PATH: "market_sentiment_v2/config.yaml"  # Path to sentiment analyzer config (auto-updated based on VERSION)
  
  # Used when MODE=MANUAL
  MANUAL_SENTIMENT: NEUTRAL  # Options: BULLISH | BEARISH | NEUTRAL | DISABLE
                             # Only valid when MODE=MANUAL
                             # When MODE=DISABLE, this is ignored

# Real-Time Position Management Configuration
# Replaces GTT-based SL/TP with real-time tick monitoring and immediate market order execution
# This eliminates GTT limit order lag and provides faster execution in volatile options markets
POSITION_MANAGEMENT:
  ENABLED: true  # Set to true to enable real-time position management (replaces GTT)
  
  # Periodic check settings (optimized for efficiency)
  CHECK_INTERVAL_SEC: 1.0  # Check positions every 1 second (when active)
  # Note: Checks only run when positions are active (95% of time = zero processing)
  
  # Gap detection (immediate triggering)
  GAP_DETECTION:
    ENABLED: true
    GAP_THRESHOLD_PERCENT: 2.0  # Check immediately if price moves >2% in single tick
    # This ensures we catch rapid movements even between periodic checks
  
  # Exit execution settings
  EXIT_EXECUTION:
    ORDER_TYPE: "MARKET"  # Always use MARKET orders
    MAX_RETRIES: 3  # Retry failed orders
    RETRY_DELAY_MS: 500  # Delay between retries
    
  # Position validation
  VALIDATION:
    ENABLED: true
    MAX_RETRIES: 5
    RETRY_INTERVAL_MS: 500
    
  # Performance tuning
  PERFORMANCE:
    MAX_CONCURRENT_CHECKS: 10  # Limit concurrent position checks
    BATCH_SIZE: 5  # Process positions in batches